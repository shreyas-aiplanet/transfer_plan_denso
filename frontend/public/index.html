<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Denso - Transfer Plan Recommendation</title>
    <link rel="stylesheet" href="../src/styles/main.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="header-left">
                    <img src="../assets/Denso.png" alt="DENSO" class="logo-image">
                    <div class="logo-divider"></div>
                    <div class="logo-subtitle">Transfer Plan Recommendation System</div>
                </div>
                <div class="header-right">
                    <button id="backToSessionsBtn" class="back-btn" style="display: none;">
                        Back to Plans
                    </button>
                    <div class="powered-by">Powered by AI Planet</div>
                </div>
            </div>
        </header>

        <!-- Plan Creation Modal -->
        <div id="sessionModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Create New Plan</h2>
                    <button class="modal-close" id="closeModalBtn">&times;</button>
                </div>

                <div class="modal-body">
                    <!-- Plan Name -->
                    <div class="form-group">
                        <label for="sessionName">Plan Name *</label>
                        <input type="text" id="sessionName" placeholder="e.g., Q1 2025 Transfer Plan" required>
                    </div>

                    <!-- CSV Upload Section -->
                    <div class="csv-upload-section">
                        <h3>Upload Data Files</h3>
                        <p class="upload-hint">Drag & drop CSV files or click to browse</p>

                        <!-- Products CSV -->
                        <div class="upload-card" id="productsDropZone">
                            <div class="upload-card-header">
                                <h4>Products Data</h4>
                                <input type="file" id="modalProductsCSV" accept=".csv" style="display: none;">
                            </div>
                            <div class="drop-zone" id="productsDropArea">
                                <svg class="drop-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                                </svg>
                                <p class="drop-text">Drop products CSV here</p>
                                <p class="drop-subtext">or click to browse</p>
                            </div>
                            <div class="file-status" id="productsFileStatus" style="display: none;">
                                <span class="status-icon">✓</span>
                                <span class="status-text"></span>
                            </div>
                            <div class="csv-preview" id="productsPreview"></div>
                        </div>

                        <!-- Plants CSV -->
                        <div class="upload-card" id="plantsDropZone">
                            <div class="upload-card-header">
                                <h4>Plants Data</h4>
                                <input type="file" id="modalPlantsCSV" accept=".csv" style="display: none;">
                            </div>
                            <div class="drop-zone" id="plantsDropArea">
                                <svg class="drop-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12"/>
                                </svg>
                                <p class="drop-text">Drop plants CSV here</p>
                                <p class="drop-subtext">or click to browse</p>
                            </div>
                            <div class="file-status" id="plantsFileStatus" style="display: none;">
                                <span class="status-icon">✓</span>
                                <span class="status-text"></span>
                            </div>
                            <div class="csv-preview" id="plantsPreview"></div>
                        </div>
                    </div>
                </div>

                <div class="modal-footer">
                    <button class="btn-secondary" id="cancelSessionBtn">Cancel</button>
                    <button class="btn-primary" id="createSessionSubmitBtn" disabled>Create Plan</button>
                </div>
            </div>
        </div>

        <!-- Application Layout with Persistent Sidebar -->
        <div class="app-layout">
            <!-- Sidebar Navigation (Always Visible) -->
            <aside class="app-sidebar">
                <nav class="sidebar-nav">
                    <a href="#" class="sidebar-nav-item active" data-page="dashboard">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"/>
                            <rect x="14" y="3" width="7" height="7"/>
                            <rect x="14" y="14" width="7" height="7"/>
                            <rect x="3" y="14" width="7" height="7"/>
                        </svg>
                        <span>Dashboard</span>
                    </a>
                    <a href="#" class="sidebar-nav-item" data-page="settings">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6M5.6 5.6l4.2 4.2m4.2 4.2l4.2 4.2M1 12h6m6 0h6M5.6 18.4l4.2-4.2m4.2-4.2l4.2-4.2"/>
                        </svg>
                        <span>Settings</span>
                    </a>
                </nav>
            </aside>

            <!-- Main Content Container -->
            <div class="main-content-container">
                <!-- Sessions Page (Landing Page) -->
                <div id="sessionsPage" class="sessions-page">
                    <div class="sessions-toolbar">
                        <div class="sessions-toolbar-left">
                            <h1>Transfer Plans</h1>
                            <p class="sessions-description">Manage and create transfer plans</p>
                        </div>
                        <div class="sessions-toolbar-right">
                            <button class="btn-primary" id="createSessionBtn">Create New Plan</button>
                        </div>
                    </div>

                    <div class="sessions-container">
                        <!-- Empty State (shown when no plans) -->
                        <div id="sessionsEmptyState" class="sessions-empty-state" style="display: none;">
                            <div class="empty-state-icon">
                                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                    <path d="M9 12h6m-6 4h6"/>
                                </svg>
                            </div>
                            <h2>No Plans Yet</h2>
                            <p>Get started by creating your first transfer plan.</p>
                            <p class="empty-state-hint">Click "Create New Plan" button above to begin.</p>
                        </div>

                        <div class="sessions-grid" id="sessionsGrid">
                            <!-- Existing plans will be added here dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Plan Content Area Wrapper -->
                <div class="main-layout sessions-mode" id="mainApp">
                <!-- Main Content Area -->
            <div class="content-wrapper">
                <!-- Step Progress Indicator -->
                <div class="stepper">
                    <div class="step active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-label">Data Management</div>
                    </div>
                    <div class="step-divider"></div>
                    <div class="step" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-label">Generate Plan</div>
                    </div>
                    <div class="step-divider"></div>
                    <div class="step" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-label">Results</div>
                    </div>
                </div>

                <main>
                    <!-- Data Management Tab (Combined Products + Plants) -->
                    <section id="data-management-tab" class="tab-content active">
                        <div class="page-header">
                            <h2>Data Management</h2>
                            <p class="section-description">Manage products and plants for transfer plan optimization</p>
                        </div>

                        <!-- Sub-tabs for Products and Plants -->
                        <div class="sub-tabs">
                            <button class="sub-tab-btn active" data-subtab="products">Products</button>
                            <button class="sub-tab-btn" data-subtab="plants">Plants</button>
                        </div>

                        <!-- Products Section -->
                        <div id="products-section" class="sub-tab-content active">
                            <div class="card">
                                <div class="card-header">
                                    <h3>Products List</h3>
                                    <div style="display: flex; gap: 10px;">
                                        <button id="loadProducts" class="btn-secondary">Refresh</button>
                                        <button id="uploadProductsCSVBtn" class="btn-primary">Upload CSV</button>
                                        <input type="file" id="productsCSVUpload" accept=".csv" style="display: none;">
                                    </div>
                                </div>
                                <div id="productsList" class="data-table"></div>
                            </div>

                            <div class="card">
                                <h3>Add New Product</h3>
                                <form id="addProductForm" class="form-grid">
                                    <div class="form-group">
                                        <label for="productId">Product ID (SKU) *</label>
                                        <input type="text" id="productId" placeholder="e.g., SKU-001" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="currentPlantId">Current Plant ID *</label>
                                        <input type="text" id="currentPlantId" placeholder="e.g., PLANT-JP-01" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="monthlyDemand">Monthly Demand (pcs) *</label>
                                        <input type="number" id="monthlyDemand" placeholder="e.g., 10000" step="1" min="0" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="currentUnitCost">Current Unit Cost ($) *</label>
                                        <input type="number" id="currentUnitCost" placeholder="e.g., 25.50" step="0.01" min="0" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="unitVolume">Unit Volume/Weight</label>
                                        <input type="number" id="unitVolume" placeholder="Optional" step="0.01" min="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="cycleTime">Cycle Time (sec)</label>
                                        <input type="number" id="cycleTime" placeholder="Optional" step="0.1" min="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="yieldRate">Yield Rate (%)</label>
                                        <input type="number" id="yieldRate" placeholder="Optional" step="0.1" min="0" max="100">
                                    </div>
                                    <div class="form-group full-width">
                                        <button type="submit" class="btn-primary">Add Product</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Plants Section -->
                        <div id="plants-section" class="sub-tab-content">
                            <div class="card">
                                <div class="card-header">
                                    <h3>Plants List</h3>
                                    <div style="display: flex; gap: 10px;">
                                        <button id="loadPlants" class="btn-secondary">Refresh</button>
                                        <button id="uploadPlantsCSVBtn" class="btn-primary">Upload CSV</button>
                                        <input type="file" id="plantsCSVUpload" accept=".csv" style="display: none;">
                                    </div>
                                </div>
                                <div id="plantsList" class="data-table"></div>
                            </div>

                            <div class="card">
                                <h3>Add New Plant</h3>
                                <form id="addPlantForm" class="form-grid">
                                    <div class="form-group">
                                        <label for="plantId">Plant ID *</label>
                                        <input type="text" id="plantId" placeholder="e.g., PLANT-JP-01" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="availableCapacity">Available Capacity (pcs/month) *</label>
                                        <input type="number" id="availableCapacity" placeholder="e.g., 50000" step="1" min="0" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="unitProductionCost">Unit Production Cost ($) *</label>
                                        <input type="number" id="unitProductionCost" placeholder="e.g., 22.00" step="0.01" min="0" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="transferFixedCost">Transfer Fixed Cost ($) *</label>
                                        <input type="number" id="transferFixedCost" placeholder="e.g., 50000" step="0.01" min="0" required>
                                    </div>
                                    <div class="form-group">
                                        <label for="effectiveOEE">Effective OEE (0-1)</label>
                                        <input type="number" id="effectiveOEE" placeholder="e.g., 0.85" step="0.01" min="0" max="1" value="1.0">
                                    </div>
                                    <div class="form-group">
                                        <label for="leadTimeToStart">Lead Time to Start (months)</label>
                                        <input type="number" id="leadTimeToStart" placeholder="e.g., 3" step="0.1" min="0" value="0">
                                    </div>
                                    <div class="form-group">
                                        <label for="riskScore">Risk Score (0-1)</label>
                                        <input type="number" id="riskScore" placeholder="Optional" step="0.01" min="0" max="1">
                                    </div>
                                    <div class="form-group">
                                        <label for="maxUtilization">Max Utilization Target (%)</label>
                                        <input type="number" id="maxUtilization" placeholder="e.g., 90" step="1" min="0" max="100" value="90">
                                    </div>
                                    <div class="form-group full-width">
                                        <button type="submit" class="btn-primary">Add Plant</button>
                                    </div>
                                </form>
                            </div>
                        </div>

                        <!-- Step Navigation -->
                        <div class="step-navigation">
                            <button type="button" class="btn-secondary" id="prevStep1" style="visibility: hidden;">Previous</button>
                            <button type="button" class="btn-primary" id="nextStep1">Next: Generate Plan</button>
                        </div>
                    </section>

                    <!-- Transfer Plan Tab -->
                    <section id="transfer-plan-tab" class="tab-content">
                        <div class="page-header">
                            <h2>Generate Transfer Plan</h2>
                            <p class="section-description">Configure optimization parameters and generate transfer plan recommendations</p>
                        </div>

                        <div class="card highlighted-card">
                            <h3>Optimization Configuration</h3>
                            <form id="generatePlanForm" class="form-grid">
                                <div class="form-group">
                                    <label for="budgetCapital">Budget Capital ($)</label>
                                    <input type="number" id="budgetCapital" placeholder="Optional - leave blank for no limit" step="0.01" min="0">
                                </div>
                                <div class="form-group">
                                    <label for="transferDeadline">Transfer Deadline</label>
                                    <input type="date" id="transferDeadline" placeholder="Optional">
                                </div>
                                <div class="form-group">
                                    <label for="discountRate">Discount Rate (0-1)</label>
                                    <input type="number" id="discountRate" placeholder="Optional" step="0.01" min="0" max="1">
                                </div>
                                <div class="form-group">
                                    <label for="objectiveFunction">Objective Function</label>
                                    <select id="objectiveFunction">
                                        <option value="minimize_cost">Minimize Total Cost</option>
                                        <option value="minimize_time">Minimize Time-to-Production</option>
                                        <option value="balance_utilization">Balance Utilization</option>
                                        <option value="multi_objective">Multi-Objective</option>
                                    </select>
                                </div>
                                <div class="form-group full-width">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="allowFractional">
                                        Allow fractional assignment (split production across plants)
                                    </label>
                                </div>
                                <div class="form-group full-width">
                                    <button type="submit" class="btn-primary btn-large">Generate Transfer Plan</button>
                                </div>
                            </form>
                        </div>

                        <div id="planGenerationStatus" class="status-message"></div>

                        <!-- Step Navigation -->
                        <div class="step-navigation">
                            <button type="button" class="btn-secondary" id="prevStep2">Previous: Data Management</button>
                            <button type="button" class="btn-primary" id="nextStep2" disabled>Next: View Results</button>
                        </div>
                    </section>

                    <!-- Results Tab -->
                    <section id="results-tab" class="tab-content">
                        <div class="page-header">
                            <h2>Transfer Plan Results</h2>
                            <p class="section-description">View the optimized transfer plan recommendations</p>
                        </div>

                        <div id="resultsContainer">
                            <div class="empty-state">
                                <p>No transfer plan generated yet</p>
                                <p class="empty-state-hint">Go back to generate a transfer plan</p>
                            </div>
                        </div>

                        <!-- Step Navigation -->
                        <div class="step-navigation">
                            <button type="button" class="btn-secondary" id="prevStep3">Previous: Generate Plan</button>
                            <button type="button" class="btn-primary" id="startOver">Start Over</button>
                        </div>
                    </section>
                </main>
            </div>
                </div>
            </div>
        </div>

        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay">
            <div class="loading-content">
                <div class="loading-spinner"></div>
                <h3 id="loadingTitle">Creating Plan...</h3>
                <p id="loadingMessage">Uploading data files, please wait...</p>
                <div class="loading-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p class="progress-text" id="progressText">0%</p>
                </div>
            </div>
        </div>

        <footer>
            <p>&copy; 2025 DENSO Corporation. All rights reserved.</p>
        </footer>
    </div>

    <script src="../src/app.js"></script>
</body>
</html>
